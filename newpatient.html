<html>
<head> 
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link href="css/main.css" rel="stylesheet" />
	<!-- <link href="css/bootstrap.css" rel="stylesheet"/> -->
	<link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">
	<link href='https://fonts.googleapis.com/css?family=Poppins:400,700' rel='stylesheet' type='text/css'>
	<script src="http://code.jquery.com/jquery-1.11.0.min.js"></script>
	<script type="text/javascript" src="js/main.js"></script>
	<script type="text/javascript" src="js/bootstrap.min.js"></script>
	<style>
	body {
	  font-family: 'Poppins', sans-serif;
	}
	.navbar-inverse {
	  background-color: #028090;
	  border-color:#028090;
	  border-radius:0;
	}
	.navbar-inverse .navbar-brand {
	  color:white;
	  font-size:32px;
	}
	.btn-default:hover{
	  background-color: #008073;
	  border-color:#008073;
	  color: white;
	}
	.btn-default {
	  color: white;
	  background-color: #00a896;
	  border-color: #00a896;
	}

	.btn-primary {
	  background-color: #00a896;
	  border-color: #00a896;
	}
	.panel-info > .panel-heading {
	  background-color: #00A896;

	}
	.panel-info {
	  border-color:#00A896;
	}

	.panel-info h3{
	  color: white;
	}

	.col-xs-4{
	  width:100%;
	}
	.col-xs-6{
	  width:100%;
	}
	@media (min-width: 480px) {
	  .col-xs-4{
	    width:33.33333%;
	  }
	  .col-xs-6{
	    width:50%;
	  }
	}
	
	/*for main.html only*/
	.navbar-inverse .navbar-nav > li > a {
	  color:white;
	}

	thead {
	  background-color: #d9edf7
	}
	.table thead tr.first-row th {
	  line-height:2;
	}
	.form-group {
	  margin-bottom:10px;
	}
	.dosageForm {
	  margin-bottom:3px;
	}
	td form.dosageForm div.form-group .dosage_delivered {
	  width:55%;
	}

	/*newpatient.html only*/
	table tr td div.panel div.panel-heading {
		background-color:#d9edf7
	}
	table tr td div.panel {
		border-color:#bce8f1;
	}
	table tr td div.panel div.panel-heading h3 {
		color:#31708f;
	}


	</style>
</head>
<body>
	<nav class="navbar navbar-inverse">
	  <div class="container-fluid">
	    <div class="navbar-header">
	      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#collapse_navbar">
	        <span class="sr-only">Toggle navigation</span>
	        <span class="icon-bar"></span>
	        <span class="icon-bar"></span>
	        <span class="icon-bar"></span>
	      </button>
	      <a class="navbar-brand" href="#">MedManager</a>
	    </div>
	    <div class="navbar-collapse collapse" id="collapse_navbar">
	      <ul class="nav navbar-nav navbar-right">

	        <!-- not a visible link because this is sort of a cheat so that we can get the alert -->
	        <li><a class="inert_a" id="currentTime"></a></li>
	        <li><a class="inert_a"><span class="glyphicon glyphicon-user"></span> Katrina</a></li>
	        <li><a href="index.html" id="login"><span class="glyphicon glyphicon-log-out"></span> Logout</a></li>
	      </ul>
	    </div>
	  </div>
	</nav>

	<div class="container-fluid">
		<form class="form-inline" role="form">
			<div class="form-group">
				<label for="inputName"> </label>
				<input type="Name" class="form-control" id="inputName" placeholder="Name" style="height:50px; font-size:18px;">
			</div>
			<div class="form-group">
		<!-- 		<label for="room" style = "font-size: 20; font-weight: normal; margin-left: -150px; vertical-align: bottom; color: #777;">Room:</label> -->
				<label for="room"> </label>
			    <input type="room" class="form-control" id="room" placeholder="Enter Room #" style="height:50px; font-size:18px;">
			  </div>
		</form>
	</div>

	<table align= "center" style="width: 98%;">
		<tr style="width: 100%;">
			<td valign = "top" style="width: 33%; padding-right: 25px;">

				<div style="text-align:center; padding-bottom: 13px;">
					<img src="photos/profile.png" style="height: 150px; width: auto;" id ="patientPhoto">
					<button type="button" id="uploadPhoto" class="btn btn-default navbar-btn" onclick = "changeImage()">Upload Photo</button>
            		<script>
						function changeImage() {
						    var image = document.getElementById('patientPhoto');
						    image.src = "photos/newpatient.png";
						}
					</script>					
            
            <!-- <span class="file-input btn btn-block btn-primary btn-file">
                Upload a photo <input type="file" multiple>
            </span> -->
     
		        </div>

				<div class="panel panel-info" >
					<div class="panel-heading">
						<h3 class="panel-title">Patient Information</h3>
					</div>
					<div class="panel-body" style="font-size: 14;">
						<form class = "form-inline">
							<div class="form-group">
								<label for "DOB" style="font-weight: normal; font-size: 14;">DOB:</label>
								<input type ="DOB" class ="form-control" id ="DOB" placeholder="mm/dd/yyyy" style= "font-size: 14;">
							</div>
							<div class="form-group">
								<label for "height" style="font-weight: normal; font-size: 14;">Height:</label>
								<input type ="height" class ="form-control" id ="height" placeholder="ft' in''" style= "font-size: 14; margin-top: 7px;">
							</div>
							<div class="form-group">
								<label for "weight" style="font-weight: normal; font-size: 14;">Weight:</label>
								<input type ="weight" class ="form-control" id ="weight" placeholder="xxx lb" style= "font-size: 14; margin-top: 7px;">
							</div>
							<div class="form-group">
								<label for "address" style="font-weight: normal; font-size: 14;">Address:</label>
								<input type ="address" class ="form-control" id ="address" placeholder="Enter address" style= "font-size: 14; margin-top: 7px;">
							</div>
							<div class="form-group">
								<label for "allergies" style="font-weight: normal; font-size: 14;">Allergies:</label>
								<input type ="allergies" class ="form-control" id ="allergies" placeholder="Enter allergies" style= "font-size: 14; margin-top: 7px;">
							</div>
						</form>
					</div>
				</div>
			</td>
			<td valign = "top" style="width: 65%;">
				<div class="panel panel-info">
					<!-- Default panel contents -->
					<div class="panel-heading">
						<h3 class="panel-title">Medication</h3>
					</div>

					<!-- Table -->
					<table class="table" id="medTable">
						<tr style="font-size: 14;">
							<th>Name</th>
							<th>Dosage</th>
							<th>Frequency</th>
						</tr>
						<tr style="font-size: 14;">
							<td> 
								<input type="name" class="form-control" id="medName" placeholder="Enter name"></td>
							<td> 
								<input type="dosage" class="form-control" id="dosage" placeholder="Enter dosage"></td></td>
							<td>
								<input type="frequency" class="form-control" id="frequency" placeholder="Enter frequency"></td></td>
						</tr>
						<tr> <td colspan = "3">
							<button type="button" id="addMed" class="btn btn-default navbar-btn">+ Add Medication</button>
						</td></tr>
					</table>
				</div>

				<div class="panel panel-info">
					<div class="panel-heading">
						<h3 class="panel-title">Medical Information</h3>
					</div>
					<div class="panel-body" style="font-size: 14;">
						<fieldset class="form-group">

							<textarea class="form-control" id="MedicalInfo" rows="8" placeholder="Enter medical information"></textarea>
						</fieldset>
					</div>
				</div>
			</td>
		</tr>
	</table>

  <script type="text/javascript">
		  $("#addMed").click(function() {
				$('#medTable tr:last').before('<tr style="font-size: 14;"><td> <input type="name" class="form-control" id="medName" placeholder="Enter name"></td><td> <input type="dosage" class="form-control" id="dosage" placeholder="Enter dosage"></td></td><td><input type="frequency" class="form-control" id="frequency" placeholder="Enter frequency"></td></td></tr>');
		});

		function addPatient() {
			var data = $.parseJSON(localStorage.getItem("data"))
			var medData = []
			var headers = []
			var table = document.getElementById("medTable")
			for (var i=0; i <table.rows[0].cells.length; i++) {
				 headers[i] = table.rows[0].cells[i].innerHTML.toLowerCase().replace(/ /gi,''); 
				 if (headers[i] == "name") {
				 	headers[i] = "medName"
				 }
			} 
			// go through cells 
			for (var i=1; i<table.rows.length-1; i++) { 
				var tableRow = table.rows[i]; var rowData = {}; 
				for (var j=0; j<tableRow.cells.length; j++) { 
					console.log($(tableRow.cells[j].children[0]).val())
					rowData[ headers[j] ] = $(tableRow.cells[j].children[0]).val(); 
				} 
				rowData["time"] = randomTime();
				medData.push(rowData); 
			} 
			data.patients.push(
				{
					name: $("#inputName").val(),
					room: $("#room").val(),
					meds: medData,
					dob: $("#DOB").val(),
					height: $("#DOB").val(),
					weight: $("#weight").val(),
					address: $("#address").val(),
					allergies: $("#allergies").val(),
					medicalInfo: $("#MedicalInfo").val(),
				});
			console.log(data)
			localStorage.setItem("data", JSON.stringify(data))
			localStorage.setItem("modified", "true");

		}

		function randomTime() {
			var hours = Math.floor((Math.random() * 12) + 1);
			var minutes = Math.floor(Math.random() * 4) * 15;
			var amPM = Math.round(Math.random());
			if (String(hours).length == 1) {
				hours = "0" + hours;
			}
			if (String(minutes).length == 1) {
				minutes = "0" + minutes;
			}
			if (amPM == 0) {
				amPM = "AM";
			} else {
				amPM = "PM";
			}
			var time = hours + ":" + minutes + amPM;
			return time;
		}
		randomTime();

	</script>


	<nav class="navbar navbar-default navbar-fixed-bottom roundbox">
    	<div class="container">
      		<a href="#" type="button" class="btn btn-default navbar-btn" style="width: 30%; height: 40px; font-size: 18; margin-left: 5%" onClick="addPatient()">Save</a>
      		<a href="main.html" type="button" class="btn btn-default navbar-btn" id="saveAndExitBtn" style="width: 30%; height: 40px; font-size: 18;" onClick="addPatient()">Save and Exit</a>
      		<button type="button" class="btn btn-default navbar-btn" data-toggle="modal" data-target="#confirmationModal" style="width: 30%; height: 40px; font-size: 18;">Exit</button>
  	</nav>

	<div class="modal fade" id="confirmationModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" style="margin-top: 11%;">
	  <div class="modal-dialog" role="document">
	    <div class="modal-content">
	      <div class="modal-header">
	        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
	        <h4 class="modal-title" id="myModalLabel">Confirm Navigation</h4>
	      </div>
	      <div class="modal-body">Are you sure you want to exit? Your changes will not be saved.</div>
	      <div class="modal-footer">
	        <a href="main.html" id="exitButton" type="button" class="btn btn-primary" style="width: 20%; font-size: 16;" autofocus>Exit</a>
	      	<button type="button" class="btn btn-primary" data-dismiss="modal" style="width: 20%; font-size: 16;">Cancel</button>
	      </div>
	    </div>
	  </div>
	</div>

</body>
</html>